<div class="flex items-center justify-center">

  <%= form_with model: product, url: [:admin, product], local: true, class:'mb-10 p-8 shadow-2xl w-4/4 ' do |form| %>

    <!-- Campo Imagen -->
    <div class="">

      <!-- Contenedor principal -->
      <div class="relative w-full h-72 border border-gray-300 rounded-md bg-gray-100 overflow-hidden">
        <% if product.image.attached? %>
          <!-- Imagen actual -->
          <%= image_tag product.image, class: "absolute inset-0 w-full h-full object-cover" %>

          <!-- Botón para eliminar la imagen -->
          <div class="absolute bottom-0 left-0 w-full bg-black bg-opacity-50 text-white flex justify-between items-center p-2 z-20">
            <span class="text-sm">Imagen actual</span>
            <button type="button" class="cursor-pointer text-sm font-bold hover:underline" onclick="document.getElementById('remove-image').click()">
              Eliminar
            </button>
            <%= form.check_box :remove_image, id: "remove-image", class: "hidden" %>
          </div>
        <% else %>
          <!-- Texto cuando no hay imagen -->
          <span class="absolute inset-0 flex items-center justify-center text-gray-500">No image available</span>
        <% end %>

        <!-- Input para agregar o cambiar la imagen -->
        <label class="absolute inset-0 w-full h-full bg-transparent cursor-pointer flex items-center justify-center hover:bg-blue-300 hover:bg-opacity-50 z-10">
          <%= form.file_field :image, class: "hidden" %>
        </label>
      </div>
    </div>

    <div class= "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 p-5">
      <!-- Campo Nombre -->
      <div class="flex flex-col">
        <%= form.label :name, "Nombre", class: "text-lg font-semibold mb-2" %>
        <%= form.text_field :name, 
            class: "w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-blue-400 " %>
      </div>

      <!-- Campo Categoría -->
      <div class="flex flex-col">
        <%= form.label :category_id, "Categoría", class: "text-lg font-semibold mb-2" %>
        <%= form.collection_select :category_id, Category.all, :id, :name, 
              { prompt: "Seleccionar" }, 
              { class: "w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-blue-400" } %>
      </div>

      <!-- Campo Descripción -->
      <div class="flex flex-col">
        <%= form.label :description, "Descripción", class: "text-lg font-semibold mb-2" %>
        <%= form.text_area :description, 
            class: "w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-blue-400" %>
      </div>

      <!-- Campo Precio -->
      <div class="flex flex-col">
        <%= form.label :price, "Precio", class: "text-lg font-semibold mb-2" %>
        <%= form.number_field :price, step: 0.01, 
            class: "w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-blue-400" %>
      </div>

      <!-- Campo Stock -->
      <div class="flex flex-col">
        <%= form.label :stock, "Stock total", class: "text-lg font-semibold mb-2" %>
        <%= form.number_field :stock, 
            class: "w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-blue-400" %>
      </div>

      <!-- Campo Precio -->
      <div class="flex flex-col">
        <%= form.label :precio, "Precio", class: "text-lg font-semibold mb-2" %>
        <%= form.number_field :precio, 
            class: "w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-blue-400" %>
      </div>
    </div>

    <br>

    <!-- Botón Submit -->
    <div class="align-middle">
      <%= form.submit "Guardar", 
          class: "bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition ease-in-out duration-200" %>
    </div>
  <% end %>

</div>

<% if product.persisted? %>

<h2 class="text-xl font-bold mt-10">Variantes</h2>

<!-- Lista de variantes -->
<div class="space-y-4">
  <% product.product_variants.each do |variant| %>
    <div class="flex items-center justify-between border p-4 rounded">
      <div>
        <p><strong>Talle:</strong> <%= variant.size %></p>
        <p><strong>Color:</strong> <%= variant.color %></p>
        <p><strong>Stock:</strong> <%= variant.stock %></p>
      </div>
      <div class="flex space-x-2">
        <!-- Botón para editar variante -->
        <%= link_to "Editar", edit_admin_product_product_variant_path(product, variant), 
                    class: "text-blue-500 hover:underline" %>

        <!-- Botón para eliminar variante -->
        <%= button_to "Eliminar", admin_product_product_variant_path(product_id: product.id, id: variant.id), 
                      method: :delete, 
                      data: { turbo_confirm: "¿Estás seguro de eliminar esta variante?" }, 
                      class: "text-red-500 hover:underline" %>
      </div>
    </div>
  <% end %>
</div>

<!-- Botón para agregar nueva variante -->
<div class="mt-4">
  <%= link_to "Agregar variante", new_admin_product_product_variant_path(product), 
              class: "bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600" %>
</div>

<%end%>